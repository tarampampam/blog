<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Индикатор загрузки страницы (css &#43; pure js) - blog [dot] hook</title>
  
  <meta name="description" content="Время загрузки страницы - самая унылая часть веб-серфинга :) До того момента, пока страница не загрузилась до конца, велика вероятность что она будет отображаться не так как мы задумывали - блоки могут &amp;ldquo;наезжать&amp;rdquo; друг на друга, текст - не отображаться (пока не загрузились шрифты), про корректную работу скриптов а анимации тоже зачастую можно забыть.">
  <meta name="author" content="Paramtamtam">
  
  <style>
    .pace {pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}
    .pace-inactive {display:none}
    .pace .pace-progress {background:#2299dd;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:1px}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"
          integrity="sha256-EPrkNjGEmCWyazb3A/Epj+W7Qm2pB9vnfXw+X6LImPM="
          crossorigin="anonymous"></script>
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/obsidian.min.css"
        integrity="sha256-DSLpkHOyIkdP+qB1tVfhDqoTis6ZnkH6fJIYxRoMUZY="
        crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0="
        crossorigin="anonymous" />
  <link href="https://blog.hook.sh/css/style.css?v=1614350667" rel="stylesheet">
  
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.hook.sh/apple-touch-icon.png?v=1614350667">
  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.hook.sh/favicon-32x32.png?v=1614350667">
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.hook.sh/favicon-16x16.png?v=1614350667">
  <link rel="manifest" href="https://blog.hook.sh/site.webmanifest">
  <meta name="msapplication-TileColor" content="#282b2f">
  <meta name="theme-color" content="#282b2f">
  
  </head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="https://blog.hook.sh/">blog [dot] hook</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
        <li class="">
          <a href="/adm/">Adm</a>
        </li>
        
        <li class="">
          <a href="/dev/">Dev</a>
        </li>
        
        <li class="">
          <a href="/docker/">Docker</a>
        </li>
        
        <li class="">
          <a href="/etc/">Etc</a>
        </li>
        
        <li class="">
          <a href="/hack/">Hack</a>
        </li>
        
        <li class="">
          <a href="/hard/">Hard</a>
        </li>
        
        <li class="">
          <a href="/mikrotik/">Mikrotik</a>
        </li>
        
        <li class="">
          <a href="/my-book-live/">My-book-live</a>
        </li>
        
        <li class="">
          <a href="/nix/">Nix</a>
        </li>
        
        <li class="">
          <a href="/php/">Php</a>
        </li>
        
        <li class="">
          <a href="/software/">Software</a>
        </li>
        
        <li class="">
          <a href="/text/">Text</a>
        </li>
        
        <li class="">
          <a href="/tnt/">Tnt</a>
        </li>
        
        <li class="">
          <a href="/wp/">Wp</a>
        </li>
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="headline">Индикатор загрузки страницы (css &#43; pure js)</h1>
    <p class="post-meta"><i class="fa fa-user-secret" aria-hidden="true"></i> <span itemprop="author">
        Paramtamtam
      </span> · 
      <i class="fa fa-calendar-check-o" aria-hidden="true"></i>&nbsp;<time datetime="2015-09-17"
        itemprop="datePublished">2015.9.17</time>
      &nbsp;&middot; <i class="fa fa-clock-o" aria-hidden="true"></i> 5 min
    </p>
  </header>
  <div class="post-content" itemprop="articleBody">
    
      <div class="post-featured-image">
        <img src="https://blog.hook.sh//images/posts/page-loading-wide.png" itemprop="image" alt="Индикатор загрузки страницы (css &#43; pure js)" />
      </div>
    

    <div class="outdated-post" data-posted-at="2015-09-17">
      <strong>Внимание!</strong> Данный пост был опубликован более года назад и, возможно, уже утратил свою былую
      актуальность. Но это не точно.
    </div>

    <p>Время загрузки страницы - самая унылая часть веб-серфинга :) До того момента, пока страница не загрузилась <strong>до конца</strong>, велика вероятность что она будет отображаться не так как мы задумывали - блоки могут &ldquo;наезжать&rdquo; друг на друга, текст - не отображаться (<em>пока не загрузились шрифты</em>), про корректную работу скриптов а анимации тоже зачастую можно забыть.</p>

<p>Можно с этим явлением ничего не делать, но корректнее было бы скрыть до момента полной загрузки <em>критичного</em> контента всё содержимое страницы, отобразив вместо него индикатор загрузки. По завершению же загрузки - скрыть индикатор, и показать пользователю уже загруженное и подготовленное браузером содержимое страницы. Именно этим мы сейчас и займемся.</p>

<p>Итак, каким же требованиям должен отвечать наш индикатор загрузки?</p>

<ul>
<li>Отсутствие растровых изображений;</li>
<li>Старые браузеры - в топку, мы будем использовать современные <code>CSS3</code> методы;</li>
<li>JavaScript поддерживается и включен по умолчанию более чем на 90% браузеров - не стесняемся его использовать;</li>
<li>Минимализм по возможности во всем - это же индикатор загрузки, и именно он должен загрузиться и отрисоваться у клиента быстрее всего;</li>
<li>И не забываем про адаптивность под мобильные гаджеты.</li>
</ul>

<p>Давай посмотрим на довольно стандартную структуру HTML-страницы:</p>

<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html lang=&quot;&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot; /&gt;
  &lt;!--link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/styles.css&quot; /--&gt;
  &lt;title&gt;...&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- Content goes here --&gt;

  &lt;!--script type=&quot;text/javascript&quot; src=&quot;js/scripts.js&quot;&gt;&lt;/script--&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Браузер получает html-код страницы и начинает по порядку загружать все внешние ресурсы в таком порядке, в каком как они указаны в теле страницы. В нашем импровизированном примере первым делом будут загружены и отрендерены 3 CSS-файла (<code>css/any.css</code>, <code>css/your.css</code> и <code>styles.css</code>), после чего - контент страницы, и по его завершению - JS скрипты (<code>js/any.js</code>, <code>js/your.js</code> и <code>js/scripts.js</code>).</p>

<p>Именно в каком порядке они у нас указаны - в таком порядке и будет происходить их загрузка (<em>исключениями являются скрипты с <a href="https://learn.javascript.ru/external-script">указанием параметра</a> <code>async</code>/<code>defer</code>)</em>.</p>

<h4 id="разрабатываем-индикатор-загрузки">Разрабатываем индикатор загрузки</h4>

<p>Для ускорения загрузки страницы код стилей и скрипта индикатора загрузки у нас будет указан прямо в теле html-страницы (<em>inline</em>). Основная его логика будет заключаться в следующем:</p>

<ol>
<li>Описываем все связанные с ним стили в теге <code>&lt;head&gt;</code> inline-кодом;</li>
<li>Первым делом в теле <code>&lt;body&gt;</code> опишем структуру нашего индикатора загрузки, <strong>перед</strong> всем содержимым страницы;</li>
<li>После загрузки всех скриптов (<em>а так как они у нас загружаются последними, то считаем что содержимое страницы к этому моменту у нас уже загружено</em>) выполним код скрипта, который проверит статус загрузки документа и скроет индикатор загрузки тем самым показав содержимое страницы.</li>
</ol>

<p>С точки зрения оформления мы будем использовать подобие прогресс-бара, стилизованного под Mac OS. Так как нам для работы необходим включенный JavaScript не забываем добавить тег <code>&lt;noscript&gt;...&lt;/noscript&gt;</code> содержащий напоминание пользователю о его необходимости. Анимация его ни к чему не привязана, сделана просто &ldquo;для красоты&rdquo;. Внешне результат у нас будет выглядеть так:</p>

<p><img src="https://hsto.org/webt/bb/lj/ws/bbljwsnmkwtr6lrnuif3-_zkubk.png" alt="screenshot" /></p>

<p>Код верстки:</p>

<pre><code class="language-html">&lt;div id=&quot;page_loading&quot; class=&quot;light&quot;&gt;
  &lt;div class=&quot;loader&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;noscript&gt;
    &lt;div class=&quot;nojs&quot;&gt;Please enable &lt;strong&gt;JavaScript&lt;/strong&gt; and reload this page
      &lt;p&gt;&lt;a href=&quot;http://goo.gl/d5o4zF&quot; target=&quot;_blank&quot; rel=&quot;nofollow&quot;&gt;How enable Javascript&lt;/a&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;/noscript&gt;
&lt;/div&gt;
</code></pre>

<p>И стили:</p>

<pre><code class="language-css">body.noscroll{
  min-height:100%;
  overflow:hidden
}

#page_loading{
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 1;
  z-index: 9999
}

.loader{
  position: absolute;
  top: 50%;
  left: 50%;
  height: 4px;
  width: 380px;
  margin: -2px 0 0 -190px
}

.loader&gt;div{
  animation-duration: 3s;
  animation-name: loader_width;
  background-image: linear-gradient(to right,#4cd964,#5ac8fa,#007aff,#34aadc,#5856d6,#ff2d55);
  background-size: 380px 4px;
  height: 100%;
  position: relative
}

.loader&gt;div&gt;div{
  height: 64px;
  position: absolute;
  top: 100%;
  transform: skew(45deg);
  transform-origin: 0 0;
  width: 100%
}

@keyframes loader_width {
  0%,100%{transition-timing-function:cubic-bezier(1,0,0.65,0.85)} 0%{width:0} 100%{width:100%}
}

@-webkit-keyframes loader_width {
  0%,100%{transition-timing-function:cubic-bezier(1,0,0.65,0.85)} 0%{width:0} 100%{width:100%}
}

#page_loading.light{
  background-color: #f5f7f9;
  color: #555
}

#page_loading.light a{
  color: #666;
  border-color: #555
}

#page_loading.light a:before{
  background-color: #666
}

#page_loading.light .loader{
  background-color: #e5e9eb
}

#page_loading.light .loader&gt;div&gt;div{
  background-image: linear-gradient(to bottom,#eaecee,transparent)
}

#page_loading.dark{
  background-color: #272727;
  color: #e5e5e5
}

#page_loading.dark a{
  color: #fff;
  border-color: #ccc
}

#page_loading.dark a:before{
  background-color: #ddd
}

#page_loading.dark .loader{
  background-color: transparent
}

#page_loading.dark .loader&gt;div&gt;div{
  background-image: linear-gradient(to bottom,#292929,transparent)
}

#page_loading .nojs{
  position: absolute;
  width: 300px;
  top: 50%;
  left: 50%;
  margin-left: -150px;
  margin-top: 50px;
  text-align: center;
  font: 400 18px 'Open Sans','Helvetica Neue',Helvetica,Arial,sans-serif
}

#page_loading .nojs strong,#page_loading .nojs b{
  font-weight: 800
}

#page_loading .nojs a{
  font-size: 80%;
  text-decoration: none;
  border-style: dotted;
  border-width: 0 0 1px;
  position: relative
}

#page_loading .nojs a:before{
  content: '';
  position: absolute;
  width: 100%;
  height: 1px;
  bottom: -1px;
  left: 0;
  visibility: hidden;
  -webkit-transform: scaleX(0);
  transform: scaleX(0);
  -webkit-transition: all .3s ease-in-out 0;
  transition: all .3s ease-in-out 0
}

#page_loading .nojs a:hover:before{
  visibility: visible;
  -webkit-transform: scaleX(1);
  transform: scaleX(1)
}

@media all and (max-width: 414px) {
  .loader{width:320px; height:4px; margin:-2px 0 0 -160px}
  .loader&gt;div{background-size: 320px 4px}
}
@media all and (max-width: 320px) {
  .loader{width:250px; height:4px; margin:-2px 0 0 -125px}
  .loader&gt;div{background-size: 250px 4px}
}
</code></pre>

<blockquote>
<p>Важная заметка - в теле примера реализованы два готовых &ldquo;стиля&rdquo; индикатора - темный, и светлый. Применяются они путем указания класса <code>dark</code> или <code>light</code> соответственно к тегу <code>div#page_loading</code>. Так же после адаптации кода под ваш сайт/проект полученный CSS код лучше всего пропустить через <a href="http://csscompressor.com/">CSS compressor</a> (<em>в случае необходимости его поправить там же его можно и &ldquo;разжать&rdquo;</em>).</p>
</blockquote>

<p>Теперь перейдем к сокрытию индикатора. Для этого мы будем использовать небольшой js-скрипт <strong>после</strong> загрузки всех скриптов (<em>в самом конце страницы</em>). Всё что он делает - это с интервалом в 10 мс. проверяет <code>document.readyState</code>, и как только последний получит статус <code>complete</code>, то:</p>

<ul>
<li>Скрывает (<em>и удаляет из DOM</em>) индикатор загрузки;</li>
<li>Удаляет класс <code>noscroll</code> у тега <code>&lt;body /&gt;</code>;</li>
<li>Останавливает работу проверяющего цикла;</li>
</ul>

<p>Посмотрим на его исходник:</p>

<pre><code class="language-javascript">// Hide loading overlay &lt;div /&gt; (with spinner) after page complete loading. After hiding,
//   &lt;div /&gt; will be removed, and for &lt;body&gt; removed css class 'noscroll'
var _loading_spinner=setInterval(function(){if(document.readyState==='complete'){
  var $page_loading = document.getElementById('page_loading'),
      $body = document.body || document.getElementsByTagName('body')[0],
      speed = 300, delay = 300;
  if((typeof $page_loading !== 'undefined') &amp;&amp; ($page_loading != null)){
    setTimeout(function(){
      var transition = 'opacity ' + speed.toString() + 'ms ease',
          removeCssClass = function(obj, className){
            obj.className = obj.className.replace(className, '').replace('  ', ' ');
          };
      ['-webkit-transition','-moz-transition','transition'].forEach(function(prefix){
        $page_loading.style[prefix] = transition;
      });
      $page_loading.style['opacity'] = '0';
      $page_loading.style['filter']  = 'alpha(opacity=0)';
      removeCssClass($body, 'noscroll');
      setTimeout(function(){
        $page_loading.parentNode.removeChild($page_loading);
      }, speed + 10);
    }, delay);
  }
  clearInterval(_loading_spinner);
}},10);
</code></pre>

<p>Думаю, теперь разработать свой индикатор загрузки страницы тебе будет несколько легче. Если возникнут какие-либо вопросы - можешь их задавать в комментариях ниже.</p>

<h4 id="ссылки">Ссылки</h4>

<ul>
<li><a href="http://codepen.io/collection/HtAne/">Коллекция различных CSS индикаторов загрузки</a></li>
<li><a href="http://github.hubspot.com/pace/docs/welcome/">Pace.js</a></li>
</ul>

    
    </blockquote>
  </div>
  <footer class="post-footer">
    
    <ul class="post-tags">
      
      <li><a href="https://blog.hook.sh/tags/css/">css</a></li>
      
      <li><a href="https://blog.hook.sh/tags/css3/">css3</a></li>
      
      <li><a href="https://blog.hook.sh/tags/html/">html</a></li>
      
      <li><a href="https://blog.hook.sh/tags/javascript/">javascript</a></li>
      
      <li><a href="https://blog.hook.sh/tags/loading/">loading</a></li>
      
      <li><a href="https://blog.hook.sh/tags/usability/">usability</a></li>
      
    </ul>
    

    <a href="https://github.com/tarampampam/blog/edit/master/content/dev/page-loading-indicator-pure-js.md" class="edit-post">
      <i class="fa fa-pencil" aria-hidden="true"></i> Редактировать
    </a>
  </footer>
  

  
    <div class="comments-area">
      
      <div id="utteranc-comments"></div>
      <script>
        (function () {
          window.setTimeout(function () {
            let d = document, s = d.createElement('script');
            s.src = 'https://utteranc.es/client.js';
            s.setAttribute('repo', 'tarampampam\/blog');
            s.setAttribute('issue-term', 'pathname');
            s.setAttribute('crossorigin', 'anonymous');
            s.setAttribute('theme', 'photon-dark');
            s.async = true;
            s.defer = true;
            d.getElementById('utteranc-comments').appendChild(s);
          }, 100);
        })();
      </script>
      

      

    
  </div>
  
</article>
</main>
<footer class="footer">
  <span>2021 &copy; Make love, not war</span>
  
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"
        integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw="
        crossorigin="anonymous"
        data-no-instant></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/routeros.min.js"
        integrity="sha256-OKUUrep5sRJC/VrDnr9rTdY7XR5M/KJ+VfoWqf8Hsic="
        crossorigin="anonymous"
        data-no-instant></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"
        integrity="sha256-tvm0lHsuUZcOfj/0C9xJTU4OQx5KpUgxUcAXLX5kvwA="
        crossorigin="anonymous"
        data-no-instant></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"
        integrity="sha256-2axosoqkcFJ3cXezszojJ8/PdK8VCYVPOwNq7ersKfk="
        crossorigin="anonymous"
        data-no-instant></script>
<script data-no-instant>
  (function () {

    if (typeof hljs === 'object') {
      hljs.initHighlightingOnLoad();
    }

    let
      $toggle = document.querySelector('.menu-toggle'),
      $body = document.querySelector('body'),
      $outdated = document.querySelectorAll('.outdated-post');

    $toggle.addEventListener('click', function () {
      $body.classList.toggle('noscroll');
    }, false);

    for (var i = 0, len = $outdated.length; i < len; i++) {
      let
        $el = $outdated[i],
        now = new Date(),
        posted_at = new Date($el.getAttribute('data-posted-at')),
        diff = Math.abs(now.getTime() - posted_at.getTime()),
        days = Math.ceil(diff / (1000 * 3600 * 24));

      if (days >= 547  ) {
        $el.style.display = 'block';
        $el.style.visibility = 'visible'
      }
    }

  })();
</script>
</body>
</html>

